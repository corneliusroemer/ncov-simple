origins:
  genbank:
    metadata: "s3://nextstrain-data/ncov-ingest/genbank_metadata.tsv.gz"
    sequences: "s3://nextstrain-data/ncov-ingest/genbank_sequences.fasta.gz"
    exclude: "https://raw.githubusercontent.com/nextstrain/ncov/master/defaults/exclude.txt"
    filters: "--min-length 27000"
    mask: "--mask-from-beginning 100 --mask-from-end 100"

builds:
  europe:
    subsamples:
      global_early:
        filters: "--exclude-where region=Europe --group-by country year month --subsample-max-sequences 200 --max-date 2021-02-01"
      europe_early:
        filters: "--exclude-where region!=Europe --group-by country year month --subsample-max-sequences 500 --max-date 2021-02-01"
      global_late:
        filters: "--exclude-where region=Europe --group-by country year month --subsample-max-sequences 500 --min-date 2021-02-01"
        priorities: "europe_late"
      europe_late:
        filters: "--exclude-where region!=Europe --group-by country year month --subsample-max-sequences 1000 --min-date 2021-02-01"


templated-builds:
  build_patterns:
    region:
      north-america: "North America"
      asia: "Asia"
    size:
      4k: 4000
      2k: 2000
  build_name: "{region}_{size}"
  subsampling_parameters:
    date_cutoff: "(datetime.date.today() - datetime.timedelta(weeks=18)).strftime('%Y-%m-%d')"
    s_global_early: "int(0.1*{size})"
    s_global_late:  "int(0.2*{size})"
    s_region_early: "int(0.3*{size})"
    s_region_late:  "int(0.4*{size})"
  subsamples:
    global_early:
      filters: "--exclude-where region='{region}' --group-by country year month --subsample-max-sequences {s_global_early} --max-date {date_cutoff}"
    region_early:
      filters: "--exclude-where region!='{region}' --group-by country year month --subsample-max-sequences {s_region_early} --max-date {date_cutoff}"
    global_late:
      filters: "--exclude-where region='{region}' --group-by country year month --subsample-max-sequences {s_global_late} --min-date {date_cutoff}"
      priorities: "region_late"
    region_late:
      filters: "--exclude-where region!='{region}' --group-by country year month --subsample-max-sequences {s_region_late} --min-date {date_cutoff}"
